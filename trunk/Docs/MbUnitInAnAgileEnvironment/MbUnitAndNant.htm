<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
   <title>Automating MbUnit With NAnt</title>
   <link href="../Styles/MbUnitDocs.css" rel="stylesheet" type="text/css" />
</head>
<body>
   <h1>
      Automating MbUnit With NAnt</h1>
   <p>
      NAnt is one of the two most commonly used automated build tools for .NET projects,
      the other being MSBuild. Using it rather than Visual Studio directly means that
      you can</p>
   <ul>
      <li>Run scheduled or triggered builds for your project</li>
      <li>Run any number of pre- and post-build events on your code, such as unit testing,
         code analysis and code metrics packages.</li>
   </ul>
   <p>
      and all without a sniff of Visual Studio. NAnt is a free, open source project downloadable
      from <a href="http://nant.sourceforge.net">http://nant.sourceforge.net</a>. Its
      build scripts are written as XML documents and can be automated or run manually
      as appropriate. You can find <a href="http://nant.sourceforge.net/release/latest/help/">
         the reference manual here</a>.</p>
   <h2>
      The MbUnit Custom NAnt Task</h2>
   <p>
      MbUnit includes code for a custom &lt;mbunit&gt; NAnt task which makes the running
      of unit tests through MbUnit and subsequent report generation much more straightforward.
      To get this working, you&#8217;ll need to</p>
   <ol>
      <li>Copy the following DLLs from the MbUnit installation directory to the NAnt bin
         directory.
         <ul>
            <li>MbUnit.Tasks.dll</li>
            <li>MbUnit.Framework.dll</li>
            <li>QuickGraph.dll</li>
            <li>QuickGraph.Algorithms.dll</li>
         </ul>
         If you&#8217;ve used other MbUnit DLLs in your test code, you&#8217;ll need to include
         those as well, but these four are the minimum. </li>
      <li>Include the &lt;mbunit&gt; task in one of your nAnt scripts. For example, the following
         script runs the tests in FizzBuzzTests.dll, creates a HTML report of the test run
         and saves it in the current directory.
         <pre class="csharpcode"><span class="kwrd">&lt;</span><span class="html">project</span> <span
            class="attr">default</span><span class="kwrd">="tests"</span><span class="kwrd">&gt;</span>
   <span class="kwrd">&lt;</span><span class="html">target</span> <span class="attr">name</span><span
      class="kwrd">="tests"</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">mbunit</span>
         <span class="attr">report-types</span><span class="kwrd">="Html"</span>
         <span class="attr">report-filename-format</span><span class="kwrd">="myreport{0}{1}"</span>
         <span class="attr">report-output-directory</span><span class="kwrd">="."</span>
         <span class="attr">halt-on-failure</span><span class="kwrd">="true"</span><span class="kwrd">&gt;</span>
         <span class="kwrd">&lt;</span><span class="html">assemblies</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">include</span> <span class="attr">name</span><span
               class="kwrd">=&quot;FizzBuzzTests.dll"</span> <span class="kwrd">/&gt;</span> 
         <span class="kwrd">&lt;/</span><span class="html">assemblies</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;/</span><span class="html">mbunit</span><span class="kwrd">&gt;</span>
   <span class="kwrd">&lt;/</span><span class="html">target</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">project</span><span class="kwrd">&gt;</span></pre>
      </li>
      <li>Run the build script.</li>
   </ol>
   <h3>
      Full Syntax</h3>
   <pre class="csharpcode"><strong>&lt;mbunit</strong>
   [report-types="<em>testType</em>"]
   [report-filename-format="<em>reportName</em>"]
   <strong>report-output-directory="<em>reportDirectory</em>"</strong>
   [halt-on-failure="<em>{true|false}</em>"<strong>&gt;</strong>
   <strong>&lt;assemblies&gt;</strong>
      <strong>&lt;include</strong> name="<em>testAssembly</em>" <strong>/&gt;</strong>
      [<em>&lt;include name="testAssembly" /&gt; ...</em>]
   <strong>&lt;/assemblies&gt; &lt;/mbunit&gt;</strong></pre>
   <h3>
      &lt;mbunit&gt; Attributes</h3>
   <p>
      &lt;mbunit&gt; has the following attributes:</p>
   <ul>
      <li><strong>report-types</strong> : Specifies what type of report will be generated
         after the test run. <em>testType</em> is one of the following types - html, text,
         xml, dox. The default is html.</li>
      <li><strong>report-filename-format</strong> : Specifies the name of the test report
         file being generated. By default, <em>reportName</em> is set to &#8220;mbunit-result-{0}{1}&#8221;
         where {0} is replaced by a long datetime string and {1} is replaced by the time
         (on a 24hr clock).</li>
      <li><strong>report-output-directory</strong> : Specifies the directory where the test
         report file will be saved. <em>reportDirectory</em> can be either an absolute path
         or relative to the current directory when NAnt is run. Note that this attribute
         is mandatory and must be given a value.</li>
      <li><strong>halt-on-failure</strong> : Specifies whether or not the rest of the NAnt
         script should halt if test failures occur. It can have values of true or false.
         The default is false.</li>
   </ul>
   <h3>
      &lt;mbunit&gt; Child Elements</h3>
   <p>
      &lt;mbunit&gt; has one child element, &lt;assemblies&gt;. This must be included
      in the task. The name and location of each test file to be run by MbUnit must be
      included here. The example here uses individual child &lt;include&gt; elements here,
      but is subject to <a href="http://nant.sourceforge.net/release/latest/help/types/fileset.html">
         the same syntax rules as the NAnt fileset type</a>.</p>
</body>
</html>
