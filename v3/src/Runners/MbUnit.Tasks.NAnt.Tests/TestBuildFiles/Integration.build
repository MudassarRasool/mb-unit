<?xml version="1.0" ?>
<project name="TestProject" default="RunMbUnit">
  <loadtasks assembly="..\bin\MbUnit.Tasks.NAnt.dll" />
  <property name="TestAssembly" value="..\bin\MbUnit.TestResources.MbUnit2.dll" />
  
  <target name="PassingTests">
    <mbunit result-property="ExitCode" filter="Type=PassingTests">
      <assemblies>
        <include name="${TestAssembly}" />
      </assemblies>
      <plugin-directories>
        <include name="${GallioPath}" />
      </plugin-directories>
    </mbunit>
    
    <fail if="${ExitCode != '0'}" >Expected successful result code, was ${ExitCode}!</fail>
  </target>

  <target name="FailingTests">
    <mbunit filter="Type=FailingFixture">
      <assemblies>
        <include name="${TestAssembly}" />
      </assemblies>
      <plugin-directories>
        <include name="${GallioPath}" />
      </plugin-directories>
    </mbunit>
    
    <fail>Expected failure result code, so should not have reached this point.</fail>
  </target>

  <target name="FailingTestsWithIgnoreFailures">
    <mbunit result-property="ExitCode" filter="Type=FailingFixture" failonerror="false">
      <assemblies>
        <include name="${TestAssembly}" />
      </assemblies>
      <plugin-directories>
        <include name="${GallioPath}" />
      </plugin-directories>
    </mbunit>
    
    <fail if="${ExitCode != '1'}" >Expected failure result code, was ${ExitCode}!</fail>
  </target>

  <target name="NoAssemblies">
    <mbunit result-property="ExitCode">
      <assemblies>
      </assemblies>
      <plugin-directories>
        <include name="${GallioPath}" />
      </plugin-directories>
    </mbunit>
    
    <fail if="${ExitCode != '16'}" >Expected NoTests result code, was ${ExitCode}!</fail>
  </target>

  <target name="NoTests">
    <mbunit result-property="ExitCode" filter="Type=NoSuchType">
      <assemblies>
        <include name="${TestAssembly}" />
      </assemblies>
      <plugin-directories>
        <include name="${GallioPath}" />
      </plugin-directories>
    </mbunit>
    
    <fail if="${ExitCode != '16'}" >Expected NoTests result code, was ${ExitCode}!</fail>
  </target>

  <target name="NoFilter">
    <mbunit result-property="ExitCode" failonerror="false">
      <assemblies>
        <include name="${TestAssembly}" />
      </assemblies>
      <plugin-directories>
        <include name="${GallioPath}" />
      </plugin-directories>
    </mbunit>
    
    <fail if="${ExitCode != '1'}" >Expected failure result code, was ${ExitCode}!</fail>
  </target>  
</project>
